#include <stdio.h>
#include <stdint.h>

unsigned int next[17][13] = {
  //              N   N       N   N       N   N
  /*  0 */ {  0,  0,  6,  0,  5,  0,  0,  4,  0,  0,  3,  0,  2},
  /*  1 */ {  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
  /*  2 */ {  0,  0, 16,  0,  5,  0,  0,  4,  0,  0,  3,  0,  2},
  /*  3 */ {  0,  0,  0,  0,  0,  0,  0,  0, 13, 12,  0,  0,  0},
  /*  4 */ {  0,  0,  0,  0,  0,  9,  8,  0,  0,  0,  0,  0,  0},
  /*  5 */ {  0,  0,  0,  7,  0,  0,  0,  0,  0,  0,  0,  0,  0},
  /*  6 */ {  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
  /*  7 */ {  0,  0,  0,  0, 10,  0,  0,  4,  0,  0,  3,  0,  2},
  /*  8 */ {  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
  /*  9 */ {  0,  0,  0,  0,  0, 11,  8,  0,  0,  0,  0,  0,  0},
  /* 10 */ {  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
  /* 11 */ {  0,  0,  0,  0,  0,  0,  0, 14,  0,  0,  3,  0,  2},
  /* 12 */ {  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
  /* 13 */ {  0,  0,  0,  0,  0,  0,  0,  0, 15, 12,  0,  0,  0},
  /* 14 */ {  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0},
  /* 15 */ {  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 17,  0},
  /* 16 */ {  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0}
};
  //          N   N   N   N   N   N
  /*  0 */ {  0,  6,  5,  0,  4,  0},
  /*  1 */ {  0,  0,  0,  0,  0,  0},
  /*  2 */ {  0, 16,  5,  0,  4,  0},
  /*  3 */ {  0,  0,  0,  0,  0, 13},
  /*  4 */ {  0,  0,  0,  9,  0,  0},
  /*  5 */ {  0,  0,  0,  0,  0,  0},
  /*  6 */ {  0,  0,  0,  0,  0,  0},
  /*  7 */ {  0,  0, 10,  0,  4,  0},
  /*  8 */ {  0,  0,  0,  0,  0,  0},
  /*  9 */ {  0,  0,  0, 11,  0,  0},
  /* 10 */ {  0,  0,  0,  0,  0,  0},
  /* 11 */ {  0,  0,  0,  0, 14,  0},
  /* 12 */ {  0,  0,  0,  0,  0,  0},
  /* 13 */ {  0,  0,  0,  0,  0, 15},
  /* 14 */ {  0,  0,  0,  0,  0,  0},
  /* 15 */ {  0,  0,  0,  0,  0,  0},
  /* 16 */ {  0,  0,  0,  0,  0,  0}

  //                    
  /*  0 */ {  0,  0,  0,  3,  0,  2},
  /*  1 */ {  0,  0,  0,  0,  0,  0},
  /*  2 */ {  0,  0,  0,  3,  0,  2},
  /*  3 */ {  0,  0, 12,  0,  0,  0},
  /*  4 */ {  0,  8,  0,  0,  0,  0},
  /*  5 */ {  7,  0,  0,  0,  0,  0},
  /*  6 */ {  0,  0,  0,  0,  0,  0},
  /*  7 */ {  0,  0,  0,  3,  0,  2},
  /*  8 */ {  0,  0,  0,  0,  0,  0},
  /*  9 */ {  0,  8,  0,  0,  0,  0},
  /* 10 */ {  0,  0,  0,  0,  0,  0},
  /* 11 */ {  0,  0,  0,  3,  0,  2},
  /* 12 */ {  0,  0,  0,  0,  0,  0},
  /* 13 */ {  0,  0, 12,  0,  0,  0},
  /* 14 */ {  0,  0,  0,  0,  0,  0},
  /* 15 */ {  0,  0,  0,  0, 17,  0},
  /* 16 */ {  0,  0,  0,  0,  0,  0}

size_t action[17][6] = {
  /*  0 */ {  0,  0,  0,  2,  0,  2},
  /*  1 */ { 11, 11, 11,  0, 11,  0},
  /*  2 */ {  0,  0,  0,  2,  0,  2},
  /*  3 */ {  9,  9,  2,  0,  9,  0},
  /*  4 */ {  6,  2,  0,  0,  6,  0},
  /*  5 */ {  1,  0,  0,  0,  0,  0},
  /*  6 */ {  0,  0,  0,  0,  0,  0},
  /*  7 */ {  0,  0,  0,  2,  0,  2},
  /*  8 */ {  4,  0,  0,  0,  4,  0},
  /*  9 */ {  6,  2,  0,  0,  6,  0},
  /* 10 */ {  5,  0,  0,  0,  5,  0},
  /* 11 */ {  0,  0,  0,  2,  0,  2},
  /* 12 */ {  7,  7,  0,  0,  7,  0},
  /* 13 */ {  9,  9,  2,  0,  9,  0},
  /* 14 */ {  8,  8,  0,  0,  8,  0},
  /* 15 */ {  0,  0,  0,  0,  2,  0},
  /* 16 */ { 10, 10, 10,  0, 10,  0}
};

size_t nprods[9] = {
  2, 2, 3, 0, 2, 3, 0, 3, 1
};

unsigned char sprods_r[9] = {
  1, 2, 5, 5, 4, 8, 8, 7, 7
};

unsigned char trms_r[6] = {
  3, 6, 9, 10, 11, 12
};

int
main(void) {
  typedef unsigned char sym_t;
  sym_t input[] = {
    // id * id + id $
    5, 2, 5, 1, 5, 0
  };
  typedef unsigned int item_t;
  item_t states[20];
  size_t states_len = 0;
  states[states_len++] = 0;
  size_t input_i = 0;
  for (;;) {
    //type val = to_val(input[input_i]);
    sym_t sym = input[input_i];
    size_t act = action[states[states_len - 1]][sym];
    printf("act %2zu ", act);
    if (act >= 3) {
      size_t prod = act - 3;
      states_len -= nprods[prod];
      states[states_len] = next[states[states_len - 1]][sprods_r[prod]] - 1;
      states_len++;
      //switch (prod) {
      //  case 0:
      //    stack[states_len - 1] = (stack[states_len - 1] +
      //                             stack[states_len + 1]);
      //    break;
      //  case 1:
      //    break;
      //}
    } else if (act == 2) {
      input_i++;
      states[states_len] = next[states[states_len - 1]][trms_r[sym]] - 1;
      states_len++;
      //stack[states_len - 1] = val;
    } else if (act == 1) {
      printf(" accept\n");
      break;
    } else {
      printf(" error\n");
      break;
    }
    for (size_t i = 0; i < states_len; i++)
      printf(" %zu", states[i]);
    printf("\n");
  }
  return 0;
}
